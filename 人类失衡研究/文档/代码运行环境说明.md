# 代码运行环境说明

## 项目概述

本项目基于拓扑波动理论（Topological-Fluctuation Theory, TFT），以腐败行为为典型案例，探索人类失衡的拓扑机制。项目通过引入 homology group 理论描述拓扑链接的完整性，并采用 Metropolis 算法模拟拓扑波动的收敛过程，构建了一个三阶段拓扑修复机制："意识锚定—链接缝合—共振再平衡"。

## 环境要求

### Python版本

- Python 3.8+

### 依赖库

| 依赖库     | 版本要求 | 用途                          |
| ---------- | -------- | ----------------------------- |
| numpy      | 1.20+    | 数值计算                      |
| pandas     | 1.3+     | 数据处理和分析                |
| networkx   | 2.6+     | 网络分析                      |
| matplotlib | 3.4+     | 数据可视化                    |
| scipy      | 1.7+     | 科学计算（包括稀疏矩阵和SVD） |

## 安装依赖

### 使用pip安装

```bash
pip install numpy pandas networkx matplotlib scipy
```

### 使用requirements.txt安装

项目根目录下提供了 `requirements.txt`文件，可通过以下命令安装：

```bash
pip install -r requirements.txt
```

## 代码结构

```
人类失衡研究/
├── 代码/
│   ├── 同调群计算.py        # 实现贝蒂数和失衡指数计算
│   ├── 拓扑分析与模拟.py    # 实现拓扑分析和蒙特卡洛模拟
│   ├── 数据收集.py          # 数据下载功能
│   └── 模拟数据生成.py      # 生成模拟数据集
├── 原始资料/                # 原始数据集和资料
├── 数据结论/                # 分析结果和图表
│   ├── 图表/               # 生成的图表
│   └── 模拟结果/            # 模拟输出结果
└── 文档/                    # 项目文档
```

## 核心代码说明

### 1. 同调群计算.py

**主要功能**：

- 计算贝蒂数（β0/β1）
- 计算失衡指数II
- 计算拓扑能量E
- 计算共振一致性

**关键函数**：

- `calculate_betti_numbers(G)`: 计算网络的贝蒂数
- `calculate_imbalance_index(G)`: 计算网络的失衡指数II
- `calculate_topology_energy(G)`: 计算拓扑能量E
- `calculate_resonance_consistency(G)`: 计算共振一致性

### 2. 拓扑分析与模拟.py

**主要功能**：

- 数据加载和图构建
- Homology Group 理论分析
- Metropolis 算法模拟拓扑波动
- 三阶段拓扑修复机制
- 图表生成

**关键函数**：

- `metropolis_simulation(G, iterations=5000, temperature=0.5)`: 蒙特卡洛模拟
- `topological_repair_mechanism(G)`: 三阶段拓扑修复
- `generate_plots()`: 生成分析图表

## 运行步骤

### 1. 数据准备

#### 方案A：使用模拟数据（推荐）

```bash
# 生成模拟数据
python "代码/模拟数据生成.py"
```

#### 方案B：下载真实数据

```bash
# 尝试下载真实数据
python "代码/数据收集.py"
```

### 2. 运行拓扑分析与模拟

```bash
# 运行核心分析脚本
python "代码/拓扑分析与模拟.py"
```

### 3. 查看结果

运行完成后，结果将保存到 `数据结论/` 目录：

- `数据结论/图表/`：包含能量失衡历史图、拓扑指标对比图、网络结构图等
- `数据结论/模拟结果/`：包含能量历史、失衡历史、贝蒂数历史、共振一致性历史等
- `数据结论/`：包含拓扑指标、Betti数、关键节点等分析结果

## 模拟参数设置

### 蒙特卡洛模拟参数

| 参数                  | 默认值 | 说明              |
| --------------------- | ------ | ----------------- |
| iterations            | 5000   | 迭代次数          |
| temperature           | 0.5    | 热波动因子 (k_BT) |
| convergence_threshold | 1e-6   | 收敛阈值          |
| intervention_interval | 1000   | 干预间隔          |

### 拓扑修复参数

| 参数                 | 默认值     | 说明                   |
| -------------------- | ---------- | ---------------------- |
| top_k                | 5          | 识别的关键节点数量     |
| edge_weight_range    | [5, 10]    | 新添加边的权重范围     |
| edge_stability_range | [0.7, 0.9] | 新添加边的稳定性范围   |
| edge_imbalance_range | [0.1, 0.3] | 新添加边的失衡程度范围 |

## 数据文件说明

### 输入数据

#### 模拟数据文件

- `原始资料/topology_nodes_simulation_data.csv`：拓扑网络节点数据
- `原始资料/topology_edges_simulation_data.csv`：拓扑网络边数据
- `原始资料/corruption_simulation_data.csv`：腐败行为模拟数据
- `原始资料/moral_experiment_simulation_data.csv`：道德实验模拟数据
- `原始资料/ethics_survey_simulation_data.csv`：伦理调查模拟数据

#### 真实数据文件（如果下载成功）

- `原始资料/world_values_survey.pdf`：世界价值观调查数据
- `原始资料/ethics_survey.pdf`：伦理调查数据

### 输出数据

#### 分析结果

- `数据结论/topology_metrics.csv`：拓扑指标
- `数据结论/betti_numbers.csv`：贝蒂数
- `数据结论/key_nodes.csv`：关键节点
- `数据结论/balanced_network.graphml`：修复后的网络结构

#### 模拟结果

- `数据结论/模拟结果/energy_history.csv`：能量变化历史
- `数据结论/模拟结果/imbalance_history.csv`：失衡变化历史
- `数据结论/模拟结果/betti_history.csv`：贝蒂数变化历史
- `数据结论/模拟结果/resonance_history.csv`：共振一致性变化历史

#### 图表

- `数据结论/图表/energy_imbalance_history.png`：能量和失衡历史图
- `数据结论/图表/topology_metrics_comparison.png`：拓扑指标对比图
- `数据结论/图表/network_structure_before.png`：修复前的网络结构图
- `数据结论/图表/network_structure_after.png`：修复后的网络结构图
- `数据结论/图表/betti_numbers_visualization.png`：贝蒂数可视化图

## 常见问题及解决方案

### 1. 依赖库安装失败

**问题**：安装依赖库时出现错误

**解决方案**：

- 确保Python版本为3.8或更高
- 使用pip的最新版本：`python -m pip install --upgrade pip`
- 尝试使用国内镜像源：`pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple`

### 2. 数据加载失败

**问题**：运行脚本时无法加载数据文件

**解决方案**：

- 确保已运行 `模拟数据生成.py` 生成模拟数据
- 检查数据文件路径是否正确
- 确保CSV文件编码为UTF-8

### 3. 内存不足

**问题**：处理大型网络时出现内存不足错误

**解决方案**：

- 减少网络规模：修改 `模拟数据生成.py` 中的节点数量
- 增加系统内存
- 使用更高效的算法：代码中已对大型矩阵使用了部分SVD

### 4. 模拟收敛速度慢

**问题**：蒙特卡洛模拟收敛速度慢

**解决方案**：

- 增加温度参数：`temperature=0.8`
- 减少迭代次数：`iterations=3000`
- 调整收敛阈值：`convergence_threshold=1e-5`

## 性能优化建议

1. **使用并行计算**：对于大型网络，可以使用 `multiprocessing` 库进行并行计算
2. **内存优化**：对于大型矩阵，使用稀疏矩阵存储
3. **缓存计算结果**：对于重复计算的指标，使用缓存机制
4. **采样策略**：对于大型网络，使用采样方法减少计算量

## 复现结果

### 预期结果

运行完成后，您应该能够看到以下结果：

1. **拓扑指标变化**：修复后的网络密度、聚类系数增加，失衡程度降低
2. **贝蒂数变化**：连通分量数（h0）减少，环数（h1）趋于合理范围
3. **能量变化**：系统能量逐渐降低并趋于稳定
4. **共振一致性**：共振一致性逐渐增加

### 验证方法

1. **检查输出文件**：确保所有输出文件都已生成
2. **查看图表**：检查生成的图表是否符合预期
3. **验证数值**：对比关键指标的数值变化
4. **重复运行**：多次运行，验证结果的稳定性

## 扩展建议

1. **添加更多拓扑指标**：如中心性指标、模块化指标等
2. **实现动态网络模拟**：考虑网络的动态变化
3. **添加更多修复策略**：探索不同的拓扑修复方法
4. **应用到其他领域**：将模型应用到其他社会伦理问题
